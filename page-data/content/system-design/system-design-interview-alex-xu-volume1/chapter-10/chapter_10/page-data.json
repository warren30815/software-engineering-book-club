{
    "componentChunkName": "component---node-modules-gatsby-theme-primer-wiki-src-templates-post-query-js",
    "path": "/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/",
    "result": {"data":{"mdx":{"id":"51daafe3-bbfb-599e-8c0c-aed01074374d","tableOfContents":{"items":[{"url":"#design-pattern-notification","title":"design pattern (notification)","items":[{"url":"#notification-種類","title":"notification 種類"},{"url":"#notification-design-pattern-問題定義","title":"notification design pattern 問題定義"},{"url":"#muti-notifaction-design-pattern","title":"muti notifaction design pattern"},{"url":"#store-user-token","title":"store user token"},{"url":"#通知發送接收流程","title":"通知發送/接收流程"},{"url":"#improved","title":"improved"},{"url":"#design-deep-dive","title":"Design deep dive"}]}]},"fields":{"title":"design pattern (notification)","slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/","url":"https://warren30815.github.io/software-engineering-book-club/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/","editUrl":"https://github.com/warren30815/software-engineering-book-club/tree/main/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10.md","lastUpdatedAt":"2023-09-02T03:25:17.000Z","lastUpdated":"9/2/2023","gitCreatedAt":"2023-09-02T03:25:17.000Z","shouldShowTitle":false},"frontmatter":{"title":"","description":null,"imageAlt":null,"tags":[],"date":null,"dateModified":null,"language":null,"seoTitle":null,"image":null},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"design-pattern-notification\"\n  }, \"design pattern (notification)\"), mdx(\"h2\", {\n    \"id\": \"notification-種類\"\n  }, \"notification \\u7A2E\\u985E\"), mdx(\"p\", null, \"\\u901A\\u77E5\\u5411\\u7528\\u6236\\u767C\\u51FA\\u91CD\\u8981\\u8A0A\\u606F\\u63D0\\u9192\\uFF0C\\u4F8B\\u5982\\u65B0\\u805E\\u3001\\u7522\\u54C1\\u66F4\\u65B0\\u3001\\u6D3B\\u52D5\\u7B49\\u7B49\\u3002\\u5F15\\u7D93\\u5728\\u65E5\\u5E38\\u751F\\u6D3B\\u4E2D\\u662F\\u4E0D\\u53EF\\u6216\\u7F3A\\u7684\\u4E00\\u90E8\\u5206\\uFF0C\\u901A\\u77E5\\u7CFB\\u7D71\\u4E26\\u4E0D\\u53EA\\u6709 mobile \\u7684\\u901A\\u77E5\\u63D0\\u9192\\u800C\\u5DF2\\uFF0C\\u800C\\u662F\\u6709\\u4E09\\u7A2E\\u683C\\u5F0F\\u3002\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"push notification\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"SMS\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Email\")), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/Hyek7XC6h.png\",\n    \"alt\": null\n  }), mdx(\"h2\", {\n    \"id\": \"notification-design-pattern-問題定義\"\n  }, \"notification design pattern \\u554F\\u984C\\u5B9A\\u7FA9\"), mdx(\"p\", null, \"\\u69CB\\u5EFA\\u4E00\\u500B\\u6BCF\\u5929\\u767C\\u9001\\u6578\\u767E\\u842C\\u689D\\u901A\\u77E5\\u7684\\u53EF\\u64F4\\u5C55\\u7CFB\\u7D71\\u4E26\\u4E0D\\u662F\\u4E00\\u4EF6\\u5BB9\\u6613\\u7684\\u4E8B\\u3002\\u5B83\\u9700\\u8981\\u5C0D\\u901A\\u77E5\\u751F\\u614B\\u7CFB\\u7D71\\u6709\\u6DF1\\u5165\\u7684\\u4E86\\u89E3\\u3002\\u9019\\u908A\\u7C21\\u55AE\\u7D66\\u5927\\u5BB6\\u770B\\u4E00\\u4E0B\\u9762\\u8A66\\u904E\\u7A0B\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u7CFB\\u7D71\\u652F\\u6301\\u54EA\\u4E9B\\u985E\\u578B\\u7684\\u901A\\u77E5\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"\\u63A8\\u9001\\u901A\\u77E5\\u3001\\u77ED\\u4FE1\\u3001\\u96FB\\u5B50\\u90F5\\u4EF6\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u662F\\u5BE6\\u6642\\u7CFB\\u7D71\\u55CE\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"\\u5C31\\u8AAA\\u5B83\\u662F\\u4E00\\u500B\\u8EDF\\u5BE6\\u6642\\u7CFB\\u7D71\\u5427\\u3002\\u6211\\u5011\\u5E0C\\u671B\\u7528\\u6236\\u76E1\\u5FEB\\u6536\\u5230\\u901A\\u77E5\\u3002\\u4F46\\u662F\\uFF0C\\u5982\\u679C\\u7CFB\\u7D71\\u5DE5\\u4F5C\\u8CA0\\u8F09\\u8F03\\u9AD8\\uFF0C\\u8F15\\u5FAE\\u7684\\u5EF6\\u9072\\u662F\\u53EF\\u4EE5\\u63A5\\u53D7\\u7684\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u652F\\u6301\\u54EA\\u4E9B\\u8A2D\\u5099\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"iOS \\u8A2D\\u5099\\u3001Android \\u8A2D\\u5099\\u3001PC/mobile\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u4EC0\\u9EBC\\u6703\\u89F8\\u767C\\u901A\\u77E5\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"\\u901A\\u77E5\\u53EF\\u4EE5\\u7531\\u5BA2\\u6236\\u7AEF\\u61C9\\u7528\\u7A0B\\u5E8F\\u89F8\\u767C\\u3002\\u5B83\\u5011\\u4E5F\\u53EF\\u4EE5\\u5728\\u670D\\u52D9\\u5668\\u7AEF\\u9032\\u884C\\u5B89\\u6392\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u7528\\u6236\\u53EF\\u4EE5\\u9078\\u64C7\\u9000\\u51FA\\u55CE\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"\\u662F\\u7684\\uFF0C\\u9078\\u64C7\\u9000\\u51FA\\u7684\\u7528\\u6236\\u5C07\\u4E0D\\u518D\\u6536\\u5230\\u901A\\u77E5\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u4E3B\\u8003\\u5B98\\uFF1A\"), \"\\u6BCF\\u5929\\u767C\\u51FA\\u591A\\u5C11\\u689D\\u901A\\u77E5\\uFF1F\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u9762\\u8A66\\u8005\\uFF1A\"), \"1000\\u842C\\u689D\\u79FB\\u52D5\\u63A8\\u9001\\u901A\\u77E5\\u3001100\\u842C\\u689D\\u77ED\\u4FE1\\u3001500\\u842C\\u5C01\\u96FB\\u5B50\\u90F5\\u4EF6\\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\u88DC\\u5145\\u4E00\\u4E0B\"), \" : \\u9019\\u908A\\u6307\\u7684\\u9000\\u51FA\\u662F\\u53EF\\u4EE5\\u662F\\u95DC\\u9589\\u901A\\u77E5\\uFF0C\\u6216\\u662F\\u53D6\\u6D88\\u8A02\\u95B1\\u67D0\\u4E00\\u500B\\u983B\\u9053\\u8DDF email\"), mdx(\"h2\", {\n    \"id\": \"muti-notifaction-design-pattern\"\n  }, \"muti notifaction design pattern\"), mdx(\"p\", null, \"\\u9019\\u908A\\u4E3B\\u8981\\u4ECB\\u7D39\\uFF0CiOS \\u63A8\\u9001\\u901A\\u77E5\\u3001Android \\u63A8\\u9001\\u901A\\u77E5\\u3001\\u77ED\\u4FE1\\u548C\\u96FB\\u5B50\\u90F5\\u4EF6\\u3002\\u5B83\\u7684\\u5167\\u5BB9\\u5982\\u4E0B\\uFF1A\"), mdx(\"p\", null, \"\\u2022 \\u4E0D\\u540C\\u985E\\u578B\\u7684\\u901A\\u77E5\\n\\u2022 \\u806F\\u7E6B\\u4FE1\\u606F\\u6536\\u96C6\\u6D41\\u7A0B\\n\\u2022 \\u901A\\u77E5\\u767C\\u9001/\\u63A5\\u6536\\u6D41\\u7A0B\"), mdx(\"h3\", {\n    \"id\": \"ios-push-notification\"\n  }, \"iOS push notification\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/SkF1c7CT3.png\",\n    \"alt\": null\n  }), \"\\n\\u4E3B\\u8981\\u6709\\u4E09\\u500B\\u90E8\\u5206\\u5B8C\\u6210 iOS push notification\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Provider \\uFF1A \\u7528\\u4F86\\u767C\\u9001 push noticiaction request \\u5230 APNS\\uFF0C\\u53EF\\u4EE5\\u662F\\u4F60\\u7684\\u672C\\u5730\\u7D42\\u7AEF\\u6A5F\\uFF0C\\u6216\\u662F\\u5176\\u4ED6 microservices \\u670D\\u52D9\\uFF0C\\u5176\\u4E2D request \\u5305\\u542B\\u3002\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Device token\"), \" : \\u6BCF\\u500B user \\u7684\\u88DD\\u7F6E id\\u3002\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Payload\"), \" \\uFF1A notification \\u7684 Payload\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/HJjvsmCa3.png\",\n    \"alt\": null\n  }))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"APNS (Apple Push Notification Service) : \\u9019\\u662F APPLE \\u7528\\u4F86\\u8655\\u7406 propagate \\u7684 remote service \\uFF0C\\u7528\\u4F86 push notification \\u5230 IOS decives\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"iOS Device: client device \\u7528\\u4F86\\u7372\\u53D6 push noticiaction\"))), mdx(\"h3\", {\n    \"id\": \"android-push-notification\"\n  }, \"android push notification\"), mdx(\"p\", null, \"\\u5728 android \\u4E0A\\u4E3B\\u8981\\u662F\\u900F\\u904E FCM \\u53BB\\u5B8C\\u6210\\u9019\\u4EF6\\u4E8B ( firebase cloud message)\\uFF0C\\u800C\\u9019\\u908A\\u53EF\\u4EE5\\u642D\\u914D\\u7684 provider \\u76EE\\u524D\\u7B46\\u8005\\u7FD2\\u6163\\u662F\\u900F\\u904E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud functions\"), \" \\u642D\\u914D \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fire store\"), \"\\u53BB\\u505A \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"realtime database\"), \" \\u53BB\\u89F8\\u767C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud message\"), \" \\u3002\"), mdx(\"p\", null, \"\\u9019\\u908A\\u88DC\\u5145\\u4E0B\\u72D0\\u72F8\\u63D0\\u554F\\u7684\\u53EF\\u4E0D\\u53EF\\u4EE5\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u53BB\\u57F7\\u884C\\u9019\\u4EF6\\u4E8B\\uFF0C\\u672C\\u4EBA\\u89BA\\u5F97 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u672C\\u8EAB\\u7684\\u5B9A\\u4F4D\\u4E0D\\u592A\\u9069\\u5408\\u653E\\u5728\\u9019\\u908A\\uFF0C\\u96D6\\u7136 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u8DDF\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud functions\"), \" \\u90FD\\u662F Serverless\\uFF0C\\u4F46 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u4E3B\\u8981\\u662F\\u70BA\\u4E86\\u66F4\\u597D\\u642D\\u914D \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GCP\"), \" \\u4E0A\\u9762\\u7684\\u670D\\u52D9\\u4F8B\\u5982 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cloud Monitoring\"), \"\\u3001\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cloud Logging\\u3001Cloud Trace \"), \"\\u548C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Error Reporting\"), \"\\u7B49\\u7B49\\u540C\\u6642 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u662F\\u5C6C\\u65BC \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"container base\"), \" \\u61C9\\u7528\\uFF0C\\u6240\\u4EE5\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u6703\\u7528\\u5230\\u7684\\u74B0\\u5883\\u90FD\\u9700\\u8981\\u900F\\u904E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \"  \\u53BB\\u6253\\u5305\\uFF0C\\u4F46\\u5176\\u5BE6\\u6211\\u5011\\u53EA\\u662F\\u9700\\u8981\\u7C21\\u7C21\\u55AE\\u55AE\\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless function\"), \"\\uFF0C\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud run\"), \" \\u4F86\\u505A web api \\u904E\\u7A0B\\u76F8\\u5C0D\\u6BD4\\u8F03\\u8907\\u67E5\\uFF0C\\u540C\\u6642\\u5EF6\\u9072\\u6027\\u6216\\u662F\\u7A69\\u5B9A\\u4E0D\\u4E00\\u5B9A\\u6709\\u4FDD\\u8B49\\uFF0C\\u6709\\u9EDE\\u5927\\u6750\\u5C0F\\u7528\\uFF0C\\u800C\\u4E14\\u4E5F\\u4E0D\\u597D\\u642D\\u914D firebase \\u505A real time database\\u3002\"), mdx(\"p\", null, \"\\u5C0D\\u65BC\\u5FEB\\u901F\\u5EFA\\u7F6E\\u5C0F\\u6279\\u91CF\\u7684\\u5DE5\\u4F5C\\u6D41\\u7A0B\\u6216\\u55AE\\u4E00 Function-based \\u7684\\u670D\\u52D9\\uFF0C\\u9019\\u908A\\u6BD4\\u8F03\\u63A8\\u85A6\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cloud functions\")), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/r1s3fZkR3.png\",\n    \"alt\": null\n  }), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/SyXL6e102.png\",\n    \"alt\": null\n  }), mdx(\"h3\", {\n    \"id\": \"sms\"\n  }, \"SMS\"), mdx(\"p\", null, \"\\u5E38\\u898B\\u7684 server \\u4F8B\\u5982 \\uFF1A Twilio \\u3001Nexmo\"), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/SyqQbZyC3.png\",\n    \"alt\": null\n  }), mdx(\"h3\", {\n    \"id\": \"email\"\n  }, \"email\"), mdx(\"p\", null, \"\\u901A\\u5E38\\u6703\\u642D\\u914D\\u7B2C\\u4E09\\u65B9\\u5DE5\\u5177\\u4F8B\\u5982 \\uFF1A \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nodemailer\")), mdx(\"p\", null, \"\\u4F46\\u672C\\u4EBA\\u76EE\\u524D\\u9069\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nextjs\"), \" \\u63A8\\u85A6\\u7684\\nsender server (Resend) : \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://resend.com/docs/send-with-nodejs\"\n  }, \"https://resend.com/docs/send-with-nodejs\"), \"\\ntemplate (react email): \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react.email/docs/introduction\"\n  }, \"https://react.email/docs/introduction\")), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/ry3GbW10h.png\",\n    \"alt\": null\n  }), mdx(\"p\", null, \"\\u6574\\u9AD4\\u67B6\\u69CB\\u5982\\u4E0B\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/SJPM4-JRh.png\",\n    \"alt\": null\n  })), mdx(\"h2\", {\n    \"id\": \"store-user-token\"\n  }, \"store user token\"), mdx(\"p\", null, \"\\u8981\\u767C\\u9001\\u901A\\u77E5\\uFF0C\\u6211\\u5011\\u9700\\u8981\\u6536\\u96C6 decive token\\u3001\\u96FB\\u8A71\\u865F\\u78BC\\u6216\\u96FB\\u5B50\\u90F5\\u4EF6\\u5730\\u5740\\u3002\\u7576\\u7528\\u6236\\u5B89\\u88DD\\u6211\\u5011\\u7684\\u61C9\\u7528\\u7A0B\\u5E8F\\u6216\\u7B2C\\u4E00\\u6B21\\u8A3B\\u518A\\u6642\\uFF0CAPI\\u670D\\u52D9\\u5668\\u6703\\u6536\\u96C6\\u7528\\u6236\\u806F\\u7E6B\\u4FE1\\u606F\\u4E26\\u5C07\\u5176\\u5B58\\u5132\\u5728\\u6578\\u64DA\\u5EAB\\u4E2D\\u3002\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/S10qNZkRn.png\",\n    \"alt\": null\n  }), \"\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/ryMh4-kAh.png\",\n    \"alt\": null\n  })), mdx(\"h2\", {\n    \"id\": \"通知發送接收流程\"\n  }, \"\\u901A\\u77E5\\u767C\\u9001/\\u63A5\\u6536\\u6D41\\u7A0B\"), mdx(\"h3\", {\n    \"id\": \"high-level-design\"\n  }, \"High-level design\"), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/SkOAH-k03.png\",\n    \"alt\": null\n  }), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Service 1 to N: \\u670D\\u52D9\\u53EF\\u4EE5\\u662F\\u5FAE\\u670D\\u52D9\\u3001cron \\u4F5C\\u696D\\u6216\\u89F8\\u767C\\u901A\\u77E5\\u767C\\u9001\\u4E8B\\u4EF6\\u7684\\u5206\\u4F48\\u5F0F\\u7CFB\\u7D71\\u3002\\u4F8B\\u5982\\uFF0C\\u8A08\\u8CBB\\u670D\\u52D9\\u6703\\u767C\\u9001\\u96FB\\u5B50\\u90F5\\u4EF6\\u63D0\\u9192\\u5BA2\\u6236\\u5230\\u671F\\u4ED8\\u6B3E\\uFF0C\\u6216\\u8005\\u8CFC\\u7269\\u7DB2\\u7AD9\\u6703\\u901A\\u904E\\u77ED\\u4FE1\\u544A\\u8A34\\u5BA2\\u6236\\u4ED6\\u5011\\u7684\\u5305\\u88F9\\u5C07\\u65BC\\u660E\\u5929\\u9001\\u9054\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Notification system: \\u901A\\u77E5\\u7CFB\\u7D71\\u662F\\u767C\\u9001/\\u63A5\\u6536\\u901A\\u77E5\\u7684\\u6838\\u5FC3\\u3002\\u5F9E\\u7C21\\u55AE\\u7684\\u4E8B\\u60C5\\u958B\\u59CB\\uFF0C\\u53EA\\u4F7F\\u7528\\u4E00\\u500B\\u901A\\u77E5\\u670D\\u52D9\\u5668\\u3002\\u5B83\\u70BA\\u670D\\u52D9 1 \\u5230 N \\u63D0\\u4F9B API\\uFF0C\\u4E26\\u70BA\\u7B2C\\u4E09\\u65B9\\u670D\\u52D9\\u69CB\\u5EFA\\u901A\\u77E5\\u8CA0\\u8F09\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Third-party services: \\u5982\\u4E0A\\u4E00\\u7BC0\\u4ECB\\u7D39\\u7684 notification services \\uFF0C\\u9019\\u908A\\u8981\\u6CE8\\u610F\\u7684\\u662F\\u5C0D\\u65BC\\u65B0\\u5E02\\u5834\\u6216\\u672A\\u4F86\\u4E0D\\u53EF\\u7528\\uFF0C\\u4F8B\\u5982 fmc \\u4E0D\\u80FD\\u5728\\u4E2D\\u570B\\u4F7F\\u7528\\uFF0C\\u6240\\u4EE5\\u6539\\u6210 Jpush\\u3001PushY \\u7B49\\u7B49\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"iOS, Android, SMS, Email: User \\u7372\\u53D6\\u88DD\\u7F6E\\u7684\\u5730\\u65B9.\")), mdx(\"p\", null, \"\\u9019\\u6A23\\u7684\\u8A2D\\u8A08\\u6A21\\u5F0F\\u5C31\\u884D\\u751F\\u51FA\\u4EE5\\u4E0B\\u554F\\u984C\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Single point of failure (SPOF) \\uFF1A \\u53EA\\u8981\\u662F\\u55AE\\u9AD4\\u662F\\u67B6\\u69CB\\u5C31\\u6703\\u51FA\\u73FE\\u7684\\u554F\\u984C\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Hard to scale \\uFF1A notification systems \\u53EA\\u5728\\u4E00\\u53F0 services \\u4E2D\\u8CA0\\u8CAC\\u6240\\u6709\\u901A\\u77E5\\u7684\\u8A0A\\u606F\\uFF0C\\u5C0D\\u65BC\\u8981\\u7368\\u7ACB database \\u7684\\u64F4\\u5C55\\u6216\\u662F cache \\u90FD\\u662F\\u4E0D\\u592A\\u5BB9\\u6613\\u505A\\u5230\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Performance bottleneck \\uFF1A\\u8655\\u7406\\u548C\\u767C\\u9001\\u901A\\u77E5\\u6703\\u975E\\u5E38\\u4F54\\u7528\\u7CFB\\u7D71\\u8CC7\\u6E90\\uFF0C\\u4F8B\\u5982 email \\u4E00\\u908A\\u8981\\u8655\\u7406 html \\u5167\\u5BB9\\uFF0C\\u9084\\u8981\\u7B49\\u7B2C\\u4E09\\u65B9\\u670D\\u52D9 api \\u7D50\\u679C\\uFF0C\\u5728\\u4E00\\u500B\\u7CFB\\u7D71\\u8655\\u7406\\u6240\\u6709\\u4E8B\\u60C5\\u6703\\u9020\\u6210\\u7CFB\\u7D71\\u904E\\u8F09\\u72C0\\u6CC1\\uFF0C\\u5C24\\u5176\\u5BE6\\u5728\\u9AD8\\u5CF0\\u6642\\u6BB5\\uFF0C\\u800C\\u884D\\u751F SPOF \\u7B49\\u554F\\u984C\\u3002\")), mdx(\"h2\", {\n    \"id\": \"improved\"\n  }, \"improved\"), mdx(\"p\", null, \"\\u2022 \\u5C07 database \\u548C cache \\u79FB\\u51FA notification services\\u3002\\n\\u2022 \\u6DFB\\u52A0\\u66F4\\u591A notification servers  \\u4E26\\u8A2D\\u7F6E\\u81EA\\u52D5\\u6C34\\u5E73\\u7E2E\\u653E\\u3002\\n\\u2022 \\u6DFB\\u52A0 message queue \\u4E26\\u8A2D\\u7F6E\\u81EA\\u52D5\\u6C34\\u5E73\\u7E2E\\u653E\\uFF0C\\u900F\\u904E retry error \\u6E1B\\u5C11 api \\u4F86\\u56DE\\uFF0C\\u540C\\u6642\\u89E3\\u8026\\u7CFB\\u7D71\\u7D44\\u4EF6\\u3002\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/Hy1moW1R3.png\",\n    \"alt\": null\n  })), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Service 1 to N:\"), \" \\u5B83\\u5011\\u4EE3\\u8868\\u901A\\u904E\\u901A\\u77E5\\u670D\\u52D9\\u5668\\u63D0\\u4F9B\\u7684API\\u767C\\u9001\\u901A\\u77E5\\u7684\\u4E0D\\u540C\\u670D\\u52D9\\u3002\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Notification servers:\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u70BA\\u670D\\u52D9\\u63D0\\u4F9BAPI \\u4EE5\\u767C\\u9001\\u901A\\u77E5\\u3002\\u9019\\u4E9B API \\u53EA\\u80FD\\u5728\\u5167\\u90E8\\u8A2A\\u554F \\u6216\\u7531\\u7D93\\u904E\\u9A57\\u8B49\\u7684\\u5BA2\\u6236\\u4F86\\u9632\\u6B62\\u5783\\u573E\\u90F5\\u4EF6\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u57F7\\u884C\\u57FA\\u672C\\u9A57\\u8B49\\u4EE5\\u9A57\\u8B49\\u96FB\\u5B50\\u90F5\\u4EF6\\u3001\\u96FB\\u8A71\\u865F\\u78BC\\u7B49\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u67E5\\u8A62\\u6578\\u64DA\\u5EAB\\u6216\\u7DE9\\u5B58\\u4EE5\\u7372\\u53D6\\u5448\\u73FE\\u901A\\u77E5\\u6240\\u9700\\u7684\\u6578\\u64DA\\u3002  \\u5C07\\u901A\\u77E5\\u6578\\u64DA\\u653E\\u5165\\u6D88\\u606F\\u968A\\u5217\\u4EE5\\u9032\\u884C\\u4E26\\u884C\\u8655\\u7406\\u3002\")), mdx(\"p\", null, \"\\u4F8B\\u5982\\uFF1A\\nPOST \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://api.example.com/v/sms/send\"\n  }, \"https://api.example.com/v/sms/send\"), \"\\nRequest body\"), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/B1mqJfk0h.png\",\n    \"alt\": null\n  }), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u6D88\\u606F\\u5C0D\\u5217\"), \" \\uFF1A\\u4ED6\\u5011\\u522A\\u9664\\u7D44\\u4EF6\\u4E4B\\u9593\\u7684\\u4F9D\\u8CF4\\u95DC\\u4FC2\\u3002\\u7576\\u8981\\u767C\\u9001\\u5927\\u91CF\\u901A\\u77E5\\u6642\\uFF0C\\u6D88\\u606F\\u968A\\u5217\\u5145\\u7576\\u7DE9\\u885D\\u5340\\u3002\\u6BCF\\u7A2E\\u901A\\u77E5\\u985E\\u578B\\u90FD\\u5206\\u914D\\u6709\\u4E0D\\u540C\\u7684\\u6D88\\u606F\\u968A\\u5217\\uFF0C\\u56E0\\u6B64\\u7B2C\\u4E09\\u65B9\\u670D\\u52D9\\u7684\\u4E2D\\u65B7\\u4E0D\\u6703\\u5F71\\u97FF\\u5176\\u4ED6\\u901A\\u77E5\\u985E\\u578B\\u3002\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Workers\"), \"\\uFF1A\\u7528\\u65BC\\u76E3\\u807D handle notification service event\\u3002\"), mdx(\"p\", null, \"\\u5C0F\\u7D50\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u670D\\u52D9\\u8ABF\\u7528\\u901A\\u77E5\\u670D\\u52D9\\u5668\\u63D0\\u4F9B\\u7684 API \\u4F86\\u767C\\u9001\\u901A\\u77E5\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u901A\\u77E5\\u670D\\u52D9\\u5668\\u5F9E\\u7DE9\\u5B58\\u6216\\u6578\\u64DA\\u5EAB\\u4E2D\\u7372\\u53D6\\u5143\\u6578\\u64DA\\uFF0C\\u4F8B\\u5982\\u7528\\u6236\\u4FE1\\u606F\\u3001\\u8A2D\\u5099\\u4EE4\\u724C\\u548C\\u901A\\u77E5\\u8A2D\\u7F6E\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u5C07\\u901A\\u77E5\\u4E8B\\u4EF6\\u767C\\u9001\\u5230\\u76F8\\u61C9\\u7684\\u968A\\u5217\\u9032\\u884C\\u8655\\u7406\\u3002\\u4F8B\\u5982\\uFF0CiOS \\u63A8\\u9001\\u901A\\u77E5\\u4E8B\\u4EF6\\u88AB\\u767C\\u9001\\u5230 iOS PN \\u968A\\u5217\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Workers \\u5F9E\\u6D88\\u606F\\u968A\\u5217\\u4E2D\\u62C9\\u53D6\\u901A\\u77E5\\u4E8B\\u4EF6\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u7B2C\\u4E09\\u65B9\\u670D\\u52D9\\u5411\\u7528\\u6236\\u8A2D\\u5099\\u767C\\u9001\\u901A\\u77E5\\u3002\")), mdx(\"h2\", {\n    \"id\": \"design-deep-dive\"\n  }, \"Design deep dive\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u53EF\\u9760\\u6027\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u5176\\u4ED6\\u7D44\\u4EF6\\u548C\\u6CE8\\u610F\\u4E8B\\u9805\\uFF1A\\u901A\\u77E5\\u6A21\\u677F\\u3001\\u901A\\u77E5\\u8A2D\\u7F6E\\u3001\\u901F\\u7387\\u9650\\u5236\\u3001\\u91CD\\u8A66\\u6A5F\\u5236\\u3001\\u63A8\\u9001\\u901A\\u77E5\\u7684\\u5B89\\u5168\\u6027\\u3001\\u76E3\\u63A7\\u6392\\u968A\\u901A\\u77E5\\u548C\\u4E8B\\u4EF6\\u8DDF\\u8E2A\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u66F4\\u65B0\\u8A2D\\u8A08\\u3002\")), mdx(\"h3\", {\n    \"id\": \"reliability-可靠性\"\n  }, \"Reliability \\u53EF\\u9760\\u6027\"), mdx(\"p\", null, \"\\u5728\\u5206\\u5E03\\u5F0F\\u7CFB\\u7D71\\u8A2D\\u8A08\\u4E2D\\u4E00\\u5B9A\\u6703\\u8003\\u91CF\\u7684\\u554F\\u984C\\u9EDE\\u3002\"), mdx(\"h4\", {\n    \"id\": \"我們要怎麼防止資料遺失\"\n  }, \"\\u6211\\u5011\\u8981\\u600E\\u9EBC\\u9632\\u6B62\\u8CC7\\u6599\\u907A\\u5931\\uFF1F\"), mdx(\"p\", null, \"\\u6211\\u5011\\u53EF\\u4EE5\\u900F\\u904E workders \\u4E2D\\u89F8\\u767C notification log \\u53BB\\u8A18\\u9304\\u6BCF\\u6B21\\u63A8\\u6CE2\\u7684\\u6642\\u9593\\u9EDE\\u8207\\u4F7F\\u7528\\u8005\\u76F8\\u95DC\\u6578\\u64DA\\uFF0C\\u6B64\\u7528\\u610F\\u53EF\\u4EE5\\u4F86\\u5C0D\\u7167\\u6301\\u4E45\\u8A71 db \\u4E2D\\u7684\\u8CC7\\u6599\\u662F\\u5426\\u6709\\u5339\\u914D\\u3002\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/SyDE8GkC2.png\",\n    \"alt\": null\n  })), mdx(\"h4\", {\n    \"id\": \"收件人只會收到一次通知嗎\"\n  }, \"\\u6536\\u4EF6\\u4EBA\\u53EA\\u6703\\u6536\\u5230\\u4E00\\u6B21\\u901A\\u77E5\\u55CE\\uFF1F\"), mdx(\"p\", null, \"\\u7406\\u60F3\\u60C5\\u6CC1\\u662F\\u4E0D\\u6703\\uFF0C\\u4F46\\u5206\\u5E03\\u5F0F\\u7279\\u6027\\u53EF\\u80FD\\u6703\\u5C0E\\u81F4\\u91CD\\u8907\\u901A\\u77E5\\uFF0C\\u4E5F\\u8A31\\u662F\\u5EF6\\u9072\\u6216\\u662F\\u8CC7\\u6599\\u4E0D\\u9F4A\\u5168\\u7684\\u60C5\\u5F62\\uFF0C\\u70BA\\u4E86\\u7E73\\u5C11\\u91CD\\u8907\\u72C0\\u6CC1\\u767C\\u751F\\uFF0C\\u9700\\u8981\\u65B0\\u589E\\u9810\\u9632\\u91CD\\u8907\\u65B0\\u589E\\u6578\\u64DA\\u7684\\u6A5F\\u5236\\uFF0C\\u4F8B\\u5982\\u7576\\u7B2C\\u4E00\\u6B21\\u4E8B\\u4EF6\\u767C\\u9001\\u6642\\u96A8\\u6A5F\\u751F\\u6210\\u6307\\u5B9A event_id\\uFF0C\\u7576\\u4E0B\\u6B21\\u8981\\u518D\\u91CD\\u65B0\\u767C\\u9001\\u63A8\\u6CE2\\u6642\\u6703\\u53BB\\u6BD4\\u5C0D db \\u4E2D\\u662F\\u5426\\u5DF2\\u7D93\\u5B58\\u5728\\u7684 event_id\\uFF0C\\u4EE5\\u6B64\\u4F86\\u907F\\u514D\\u63A8\\u6CE2\\u591A\\u6B21\\u72C0\\u6CC1\\u3002\"), mdx(\"h3\", {\n    \"id\": \"additional-components-and-considerations\"\n  }, \"Additional components and considerations\"), mdx(\"p\", null, \"\\u901A\\u77E5\\u9084\\u6709\\u5176\\u4ED6\\u8003\\u91CF\\u7684\\u9EDE\\u4F8B\\u5982\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u6A21\\u677F\\u91CD\\u7528\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u901A\\u77E5\\u8A2D\\u7F6E\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u4E8B\\u4EF6\\u8DDF\\u8E2A\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u7CFB\\u7D71\\u76E3\\u63A7\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u901F\\u7387\\u9650\\u5236\")), mdx(\"h4\", {\n    \"id\": \"模板重用--notification-template-\"\n  }, \"\\u6A21\\u677F\\u91CD\\u7528 ( Notification template )\"), mdx(\"p\", null, \"\\u901A\\u77E5\\u7CFB\\u7D71\\u6BCF\\u5929\\u90FD\\u6703\\u767C\\u51FA\\u6578\\u767E\\u689D\\u7684\\u901A\\u77E5\\u5167\\u5BB9\\uFF0C\\u7E3D\\u4E0D\\u53EF\\u80FD\\u6BCF\\u6B21\\u90FD\\u91CD\\u65B0\\u751F\\u6210\\u6A21\\u677F\\uFF0C\\u9019\\u6642\\u4F60\\u53EF\\u4EE5\\u8003\\u616E\\u5148 prebuild \\u683C\\u5F0F\\u5316\\u6A21\\u677F\\u7684\\u901A\\u77E5\\uFF0C\\u4E4B\\u5F8C\\u53EA\\u9700\\u8981\\u81EA\\u5B9A\\u7FA9\\u53C3\\u6578\\u6216\\u662F\\u76F8\\u95DC link \\u5167\\u5BB9\\u5C31\\u597D\\uFF0C\\u6E1B\\u5C11\\u6A21\\u677F\\u5EFA\\u5236\\u6642\\u9593\\u3002\"), mdx(\"p\", null, \"\\u4F8B\\u5982\\u4F60\\u53EF\\u4EE5\\u5BEB\\u4E00\\u500B \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless function\"), \" \\u53BB build email template\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import type { NextApiRequest, NextApiResponse } from 'next';\\nimport { EmailTemplate } from '../../components/EmailTemplate';\\nimport { Resend } from 'resend';\\n\\nconst resend = new Resend(process.env.RESEND_API_KEY);\\n\\nexport default async (req: NextApiRequest, res: NextApiResponse) => {\\n  try {\\n    const data = await resend.emails.send({\\n      from: 'Acme <onboarding@resend.dev>',\\n      to: ['delivered@resend.dev'],\\n      subject: 'Hello world',\\n      react: EmailTemplate({ firstName: 'John' }),\\n    });\\n\\n    res.status(200).json(data);\\n  } catch (error) {\\n    res.status(400).json(error);\\n  }\\n};\\n\")), mdx(\"h4\", {\n    \"id\": \"通知設置--notification-setting-\"\n  }, \"\\u901A\\u77E5\\u8A2D\\u7F6E ( Notification setting )\"), mdx(\"p\", null, \"\\u5806\\u7528\\u6236\\u4F86\\u8AAA\\u6BCF\\u5929\\u90FD\\u8981\\u63A5\\u53D7\\u975E\\u5E38\\u591A\\u7684\\u901A\\u77E5\\u5167\\u5BB9\\uFF0C\\u6240\\u4EE5\\u52E2\\u5FC5\\u9700\\u8981\\u91DD\\u5C0D\\u63A8\\u6CE2\\u9032\\u884C\\u5206\\u985E\\uFF0C\\u5BE6\\u969B\\u60C5\\u6CC1\\u4E2D\\u6211\\u5011\\u5728\\u63A8\\u6CE2\\u4FE1\\u606F\\u7684\\u524D\\u7F6E\\u4F5C\\u696D\\u662F\\uFF0C\\u9700\\u8981\\u5148\\u5224\\u65B7\\u7528\\u6236\\u662F\\u5426\\u6709\\u8A02\\u95B1\\u67D0\\u4E00\\u500B channel \\u6216\\u662F\\u7528\\u6236\\u662F\\u5426\\u53D6\\u6D88\\u8A02\\u95B1\\uFF0C\\u9019\\u4E9B\\u90FD\\u662F\\u9700\\u8981\\u8003\\u616E\\u7684\\u56E0\\u7D20\\uFF0C\\u5982\\u679C user \\u8981\\u8A02\\u95B1\\u6BCF\\u4E00\\u500B channel (topic) \\u7684\\u8A71\\u6703\\u53BB\\u7D81\\u5B9A devicedtoken \\uFF0C\\u4E5F\\u5C31\\u662F\\u4E0B\\u65B9\\u7684\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"YOUR_REGISTRATION_TOKEN\"), \" \\u5167\\u5BB9\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"// These registration tokens come from the client FCM SDKs.\\nconst registrationTokens = [\\n  'YOUR_REGISTRATION_TOKEN_1',\\n  // ...\\n  'YOUR_REGISTRATION_TOKEN_n'\\n];\\n\\n// Subscribe the devices corresponding to the registration tokens to the\\n// topic.\\ngetMessaging().subscribeToTopic(registrationTokens, topic)\\n  .then((response) => {\\n    console.log('Successfully subscribed to topic:', response);\\n  })\\n  .catch((error) => {\\n    console.log('Error subscribing to topic:', error);\\n  });\\n  \\n\\ngetMessaging().unsubscribeFromTopic(registrationTokens, topic)\\n  .then((response) => {\\n    console.log('Successfully unsubscribed from topic:', response);\\n  })\\n  .catch((error) => {\\n    console.log('Error unsubscribing from topic:', error);\\n  });\\n\")), mdx(\"h4\", {\n    \"id\": \"rate-limiting\"\n  }, \"Rate limiting\"), mdx(\"p\", null, \"\\u4E4B\\u524D\\u8B80\\u66F8\\u6703\\u6709\\u63D0\\u5230\\u3002\"), mdx(\"h4\", {\n    \"id\": \"retry-mechanism\"\n  }, \"Retry mechanism\"), mdx(\"p\", null, \"\\u7576\\u5730\\u4E09\\u4E2D\\u670D\\u52D9\\u767C\\u9001\\u901A\\u77E5\\u5931\\u6557\\uFF0C\\u6703\\u5C07\\u8A72\\u901A\\u77E5\\u91CD\\u65B0\\u653E\\u5230\\u8A0A\\u606F\\u968A\\u5217\\u4E2D\\uFF0C\\u4E5F\\u5C31\\u662F\\u4E0A\\u9762\\u7684 retry \\uFF0C\\u5982\\u679C\\u8D85\\u904E retry \\u6B21\\u6578\\u6642\\u5C31\\u901A\\u77E5\\u958B\\u767C\\u4EBA\\u54E1\\u4E26\\u767C\\u9001\\u8B66\\u5831\\u3002\"), mdx(\"h4\", {\n    \"id\": \"security-in-push-notifications\"\n  }, \"Security in push notifications\"), mdx(\"p\", null, \"\\u5C0D\\u65BC IOS \\u6216\\u662F android \\u7528\\u6236\\u6709\\u63D0\\u4F9B appKey \\u8DDF appSecret \\u4F86\\u4FDD\\u8B77\\u63A8\\u6CE2 api \\u7684\\u5B89\\u5168\\u56E0\\u70BA\\u6703\\u9700\\u8981\\u8EAB\\u4EFD\\u9A57\\u6B63\\u3002\"), mdx(\"h4\", {\n    \"id\": \"events-tracking\"\n  }, \"Events tracking\"), mdx(\"p\", null, \"\\u900F\\u904E Monitor queued notifications \\u6211\\u5011\\u53EF\\u4EE5\\u5206\\u6790\\u7528\\u6236\\u884C\\u70BA\\uFF0C\\u4E86\\u89E3\\u7528\\u6236\\u53C3\\u8207\\u5EA6\\uFF0C\\u751A\\u81F3\\u5206\\u6790\\u670D\\u52D9\\u5BE6\\u73FE\\uFF0C\\u8207\\u4E8B\\u4EF6\\u8FFD\\u8E64\\u60C5\\u6CC1\\u4F8B\\u5982 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sentry\"), \"\\u3002\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/SJ_jZX1R3.png\",\n    \"alt\": null\n  }), \"\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://hackmd.io/_uploads/Sy5oZ7kA2.png\",\n    \"alt\": null\n  })), mdx(\"h4\", {\n    \"id\": \"finally-design\"\n  }, \"finally design\"), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/SyMdMmyC3.png\",\n    \"alt\": null\n  }), mdx(\"h4\", {\n    \"id\": \"最後總結一下優化哪些功能\"\n  }, \"\\u6700\\u5F8C\\u7E3D\\u7D50\\u4E00\\u4E0B\\u512A\\u5316\\u54EA\\u4E9B\\u529F\\u80FD\\uFF1A\"), mdx(\"p\", null, \"\\u2022 \\u901A\\u77E5\\u670D\\u52D9\\u5668\\u914D\\u5099\\u4E86\\u5169\\u500B\\u66F4\\u95DC\\u9375\\u7684\\u529F\\u80FD\\uFF1A\\u8EAB\\u4EFD\\u9A57\\u8B49\\u548C\\u901F\\u7387\\u9650\\u5236\\u3002\\n\\u2022 \\u900F\\u904E\\u91CD\\u8A66\\u6A5F\\u5236\\u4F86\\u8655\\u7406\\u901A\\u77E5\\u5931\\u6557\\u3002\\u5982\\u679C\\u7CFB\\u7D71\\u7121\\u6CD5\\u767C\\u9001\\u901A\\u77E5\\uFF0C\\u5B83\\u5011\\u5C07\\u88AB\\u653E\\u56DE\\u6D88\\u606F\\u968A\\u5217\\u4E2D\\uFF0C\\u958B\\u767C\\u8005\\u5B9A\\u7FA9\\u91CD\\u8B58\\u6B21\\u6578\\uFF0C\\u90FD\\u5931\\u6557\\u767C\\u9001\\u8B66\\u5831\\u3002\\n\\u2022 \\u901A\\u77E5\\u6A21\\u677F\\u63D0\\u4F9B\\u4E00\\u81F4\\u4E14\\u9AD8\\u6548\\u7684\\u901A\\u77E5\\u5275\\u5EFA\\u904E\\u7A0B\\u3002\\n\\u2022 \\u6DFB\\u52A0\\u4E86\\u76E3\\u63A7\\u548C\\u8DDF\\u8E2A\\u7CFB\\u7D71\\uFF0C\\u7528\\u65BC\\u7CFB\\u7D71\\u5065\\u5EB7\\u6AA2\\u67E5\\u548C\\u672A\\u4F86\\u6539\\u9032\\u3002\"), mdx(\"h3\", {\n    \"id\": \"demo-時間\"\n  }, \"demo \\u6642\\u9593\"), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/BkAM-m1Rh.png\",\n    \"alt\": null\n  }), mdx(\"img\", {\n    \"src\": \"https://hackmd.io/_uploads/rJim-XJCn.png\",\n    \"alt\": null\n  }));\n}\n;\nMDXContent.isMDXComponent = true;","rawBody":"# design pattern (notification)\n\n## notification 種類\n通知向用戶發出重要訊息提醒，例如新聞、產品更新、活動等等。引經在日常生活中是不可或缺的一部分，通知系統並不只有 mobile 的通知提醒而已，而是有三種格式。\n* push notification\n* SMS\n* Email\n\n![](https://hackmd.io/_uploads/Hyek7XC6h.png)\n\n## notification design pattern 問題定義\n\n構建一個每天發送數百萬條通知的可擴展系統並不是一件容易的事。它需要對通知生態系統有深入的了解。這邊簡單給大家看一下面試過程。\n\n`主考官：`系統支持哪些類型的通知？\n`面試者：`推送通知、短信、電子郵件。\n\n`主考官：`是實時系統嗎？\n`面試者：`就說它是一個軟實時系統吧。我們希望用戶盡快收到通知。但是，如果系統工作負載較高，輕微的延遲是可以接受的。\n\n`主考官：`支持哪些設備？\n`面試者：`iOS 設備、Android 設備、PC/mobile。\n\n`主考官：`什麼會觸發通知？\n`面試者：`通知可以由客戶端應用程序觸發。它們也可以在服務器端進行安排。\n\n`主考官：`用戶可以選擇退出嗎？\n`面試者：`是的，選擇退出的用戶將不再收到通知。\n\n`主考官：`每天發出多少條通知？\n`面試者：`1000萬條移動推送通知、100萬條短信、500萬封電子郵件。\n\n`補充一下` : 這邊指的退出是可以是關閉通知，或是取消訂閱某一個頻道跟 email\n\n## muti notifaction design pattern\n這邊主要介紹，iOS 推送通知、Android 推送通知、短信和電子郵件。它的內容如下：\n\n• 不同類型的通知\n• 聯繫信息收集流程\n• 通知發送/接收流程\n\n### iOS push notification\n![](https://hackmd.io/_uploads/SkF1c7CT3.png)\n主要有三個部分完成 iOS push notification\n\n* Provider ： 用來發送 push noticiaction request 到 APNS，可以是你的本地終端機，或是其他 microservices 服務，其中 request 包含。\n\n  **Device token** : 每個 user 的裝置 id。\n  **Payload** ： notification 的 Payload\n  ![](https://hackmd.io/_uploads/HJjvsmCa3.png)\n\n* APNS (Apple Push Notification Service) : 這是 APPLE 用來處理 propagate 的 remote service ，用來 push notification 到 IOS decives。\n* iOS Device: client device 用來獲取 push noticiaction\n\n### android push notification\n\n在 android 上主要是透過 FCM 去完成這件事 ( firebase cloud message)，而這邊可以搭配的 provider 目前筆者習慣是透過 `cloud functions` 搭配 `fire store`去做 `realtime database` 去觸發 `cloud message` 。\n\n這邊補充下狐狸提問的可不可以用 `cloud run` 去執行這件事，本人覺得 `cloud run` 本身的定位不太適合放在這邊，雖然 `cloud run` 跟`cloud functions` 都是 Serverless，但 `cloud run` 主要是為了更好搭配 `GCP` 上面的服務例如 `Cloud Monitoring`、`Cloud Logging、Cloud Trace `和 `Error Reporting`等等同時 `cloud run` 是屬於 `container base` 應用，所以在 `cloud run` 會用到的環境都需要透過 `image`  去打包，但其實我們只是需要簡簡單單的 `serverless function`，用 `cloud run` 來做 web api 過程相對比較複查，同時延遲性或是穩定不一定有保證，有點大材小用，而且也不好搭配 firebase 做 real time database。\n\n\n對於快速建置小批量的工作流程或單一 Function-based 的服務，這邊比較推薦用 `cloud functions`\n\n![](https://hackmd.io/_uploads/r1s3fZkR3.png)\n\n![](https://hackmd.io/_uploads/SyXL6e102.png)\n\n### SMS\n常見的 server 例如 ： Twilio 、Nexmo\n\n\n![](https://hackmd.io/_uploads/SyqQbZyC3.png)\n### email\n通常會搭配第三方工具例如 ： `nodemailer`\n\n但本人目前適用 `nextjs` 推薦的 \nsender server (Resend) : https://resend.com/docs/send-with-nodejs\ntemplate (react email): https://react.email/docs/introduction\n\n![](https://hackmd.io/_uploads/ry3GbW10h.png)\n\n整體架構如下\n![](https://hackmd.io/_uploads/SJPM4-JRh.png)\n\n## store user token\n要發送通知，我們需要收集 decive token、電話號碼或電子郵件地址。當用戶安裝我們的應用程序或第一次註冊時，API服務器會收集用戶聯繫信息並將其存儲在數據庫中。\n![](https://hackmd.io/_uploads/S10qNZkRn.png)\n![](https://hackmd.io/_uploads/ryMh4-kAh.png)\n\n\n## 通知發送/接收流程\n\n### High-level design\n\n![](https://hackmd.io/_uploads/SkOAH-k03.png)\n\n\n* Service 1 to N: 服務可以是微服務、cron 作業或觸發通知發送事件的分佈式系統。例如，計費服務會發送電子郵件提醒客戶到期付款，或者購物網站會通過短信告訴客戶他們的包裹將於明天送達。\n* Notification system: 通知系統是發送/接收通知的核心。從簡單的事情開始，只使用一個通知服務器。它為服務 1 到 N 提供 API，並為第三方服務構建通知負載。\n* Third-party services: 如上一節介紹的 notification services ，這邊要注意的是對於新市場或未來不可用，例如 fmc 不能在中國使用，所以改成 Jpush、PushY 等等。\n* iOS, Android, SMS, Email: User 獲取裝置的地方.\n\n這樣的設計模式就衍生出以下問題：\n*  Single point of failure (SPOF) ： 只要是單體是架構就會出現的問題。\n*  Hard to scale ： notification systems 只在一台 services 中負責所有通知的訊息，對於要獨立 database 的擴展或是 cache 都是不太容易做到。\n*  Performance bottleneck ：處理和發送通知會非常佔用系統資源，例如 email 一邊要處理 html 內容，還要等第三方服務 api 結果，在一個系統處理所有事情會造成系統過載狀況，尤其實在高峰時段，而衍生 SPOF 等問題。\n\n## improved\n• 將 database 和 cache 移出 notification services。\n• 添加更多 notification servers  並設置自動水平縮放。\n• 添加 message queue 並設置自動水平縮放，透過 retry error 減少 api 來回，同時解耦系統組件。\n![](https://hackmd.io/_uploads/Hy1moW1R3.png)\n\n**Service 1 to N:** 它們代表通過通知服務器提供的API發送通知的不同服務。\n\n**Notification servers:**\n*  為服務提供API 以發送通知。這些 API 只能在內部訪問 或由經過驗證的客戶來防止垃圾郵件。\n*  執行基本驗證以驗證電子郵件、電話號碼等。\n*  查詢數據庫或緩存以獲取呈現通知所需的數據。  將通知數據放入消息隊列以進行並行處理。\n\n例如：\nPOST https://api.example.com/v/sms/send\nRequest body\n\n![](https://hackmd.io/_uploads/B1mqJfk0h.png)\n\n**消息對列** ：他們刪除組件之間的依賴關係。當要發送大量通知時，消息隊列充當緩衝區。每種通知類型都分配有不同的消息隊列，因此第三方服務的中斷不會影響其他通知類型。\n\n**Workers**：用於監聽 handle notification service event。\n\n\n小結：\n1. 服務調用通知服務器提供的 API 來發送通知。\n2. 通知服務器從緩存或數據庫中獲取元數據，例如用戶信息、設備令牌和通知設置。\n3. 將通知事件發送到相應的隊列進行處理。例如，iOS 推送通知事件被發送到 iOS PN 隊列。\n4. Workers 從消息隊列中拉取通知事件。\n5. 第三方服務向用戶設備發送通知。\n\n## Design deep dive\n\n*  可靠性。\n*  其他組件和注意事項：通知模板、通知設置、速率限制、重試機制、推送通知的安全性、監控排隊通知和事件跟踪。\n*  更新設計。\n\n### Reliability 可靠性\n\n在分布式系統設計中一定會考量的問題點。\n\n#### 我們要怎麼防止資料遺失？\n我們可以透過 workders 中觸發 notification log 去記錄每次推波的時間點與使用者相關數據，此用意可以來對照持久話 db 中的資料是否有匹配。\n![](https://hackmd.io/_uploads/SyDE8GkC2.png)\n\n#### 收件人只會收到一次通知嗎？\n\n理想情況是不會，但分布式特性可能會導致重複通知，也許是延遲或是資料不齊全的情形，為了繳少重複狀況發生，需要新增預防重複新增數據的機制，例如當第一次事件發送時隨機生成指定 event_id，當下次要再重新發送推波時會去比對 db 中是否已經存在的 event_id，以此來避免推波多次狀況。\n\n### Additional components and considerations\n通知還有其他考量的點例如：\n\n* 模板重用\n* 通知設置\n* 事件跟踪\n* 系統監控\n* 速率限制\n\n#### 模板重用 ( Notification template )\n通知系統每天都會發出數百條的通知內容，總不可能每次都重新生成模板，這時你可以考慮先 prebuild 格式化模板的通知，之後只需要自定義參數或是相關 link 內容就好，減少模板建制時間。\n\n例如你可以寫一個 `serverless function` 去 build email template。\n```typescript\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { EmailTemplate } from '../../components/EmailTemplate';\nimport { Resend } from 'resend';\n\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\nexport default async (req: NextApiRequest, res: NextApiResponse) => {\n  try {\n    const data = await resend.emails.send({\n      from: 'Acme <onboarding@resend.dev>',\n      to: ['delivered@resend.dev'],\n      subject: 'Hello world',\n      react: EmailTemplate({ firstName: 'John' }),\n    });\n\n    res.status(200).json(data);\n  } catch (error) {\n    res.status(400).json(error);\n  }\n};\n```\n\n#### 通知設置 ( Notification setting )\n堆用戶來說每天都要接受非常多的通知內容，所以勢必需要針對推波進行分類，實際情況中我們在推波信息的前置作業是，需要先判斷用戶是否有訂閱某一個 channel 或是用戶是否取消訂閱，這些都是需要考慮的因素，如果 user 要訂閱每一個 channel (topic) 的話會去綁定 devicedtoken ，也就是下方的 \n`YOUR_REGISTRATION_TOKEN` 內容。\n\n```typescript\n// These registration tokens come from the client FCM SDKs.\nconst registrationTokens = [\n  'YOUR_REGISTRATION_TOKEN_1',\n  // ...\n  'YOUR_REGISTRATION_TOKEN_n'\n];\n\n// Subscribe the devices corresponding to the registration tokens to the\n// topic.\ngetMessaging().subscribeToTopic(registrationTokens, topic)\n  .then((response) => {\n    console.log('Successfully subscribed to topic:', response);\n  })\n  .catch((error) => {\n    console.log('Error subscribing to topic:', error);\n  });\n  \n\ngetMessaging().unsubscribeFromTopic(registrationTokens, topic)\n  .then((response) => {\n    console.log('Successfully unsubscribed from topic:', response);\n  })\n  .catch((error) => {\n    console.log('Error unsubscribing from topic:', error);\n  });\n```\n\n####  Rate limiting\n之前讀書會有提到。\n\n#### Retry mechanism\n當地三中服務發送通知失敗，會將該通知重新放到訊息隊列中，也就是上面的 retry ，如果超過 retry 次數時就通知開發人員並發送警報。\n\n#### Security in push notifications\n對於 IOS 或是 android 用戶有提供 appKey 跟 appSecret 來保護推波 api 的安全因為會需要身份驗正。\n\n#### Events tracking\n透過 Monitor queued notifications 我們可以分析用戶行為，了解用戶參與度，甚至分析服務實現，與事件追蹤情況例如 `sentry`。\n![](https://hackmd.io/_uploads/SJ_jZX1R3.png)\n![](https://hackmd.io/_uploads/Sy5oZ7kA2.png)\n\n#### finally design\n\n![](https://hackmd.io/_uploads/SyMdMmyC3.png)\n\n#### 最後總結一下優化哪些功能：\n• 通知服務器配備了兩個更關鍵的功能：身份驗證和速率限制。\n• 透過重試機制來處理通知失敗。如果系統無法發送通知，它們將被放回消息隊列中，開發者定義重識次數，都失敗發送警報。\n• 通知模板提供一致且高效的通知創建過程。\n• 添加了監控和跟踪系統，用於系統健康檢查和未來改進。\n\n### demo 時間\n![](https://hackmd.io/_uploads/BkAM-m1Rh.png)\n![](https://hackmd.io/_uploads/rJim-XJCn.png)\n","excerpt":"design pattern (notification) notification 種類 通知向用戶發出重要訊息提醒，例如新聞、產品更新、活動等等。引經在日常生活中是不可或缺的一部分，通知系統並不只有 mobile 的通知提醒而已，而是有三種格式。 push notifica…","outboundReferences":[],"inboundReferences":[]},"tagsOutbound":{"nodes":[]}},"pageContext":{"tags":[],"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/","sidebarItems":[{"title":"Categories","items":[{"title":"Content","url":"","items":[{"title":"Domain-Driven-Design","url":"","items":[{"title":"Domain-Modeling-Made-Functional","url":"/content/domain-driven-design/domain-modeling-made-functional/","items":[{"title":"Chapter-1","url":"","items":[{"title":"Domain Driven Design Made Functional","url":"/content/domain-driven-design/domain-modeling-made-functional/chapter-1/chpater_1/","items":[]}]}]}]},{"title":"Front-End","url":"","items":[{"title":"微前端","url":"/content/front-end/micro-frontend/","items":[]}]},{"title":"System-Design","url":"","items":[{"title":"System-Design-Interview-Alex-Xu-Volume1","url":"/content/system-design/system-design-interview-alex-xu-volume1/","items":[{"title":"Chapter-1","url":"","items":[{"title":"第一章：使用者人數 -- 從零到百萬規模","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-1/chapter_1/","items":[]}]},{"title":"Chapter-10","url":"","items":[{"title":"Demo","url":"","items":[{"title":"React + TypeScript + Vite","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/demo/client/","items":[]}]},{"title":"design pattern (notification)","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/","items":[]}]},{"title":"Chapter-4","url":"","items":[{"title":"第四章：設計網路限速器","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-4/chapter_4/","items":[]}]},{"title":"Chapter-7","url":"","items":[{"title":"第七章：設計可用於分散式系統的唯一 ID 生成器","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-7/chapter_7/","items":[]}]},{"title":"Chapter-8","url":"","items":[{"title":"第八章：設計短網址生成器","url":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-8/chapter_8/","items":[]}]}]}]}]},{"title":"software-engineering-book-club","url":"/","items":[]}]}],"tagsGroups":[],"latestPosts":[{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/","title":"System-Design-Interview-Alex-Xu-Volume1","lastUpdatedAt":"2023-10-22T13:09:03.000Z","lastUpdated":"10/22/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/chapter_10/","title":"design pattern (notification)","lastUpdatedAt":"2023-09-02T03:25:17.000Z","lastUpdated":"9/2/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-10/demo/client/","title":"React + TypeScript + Vite","lastUpdatedAt":"2023-09-02T03:25:17.000Z","lastUpdated":"9/2/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/domain-driven-design/domain-modeling-made-functional/chapter-1/chpater_1/","title":"Domain Driven Design Made Functional","lastUpdatedAt":"2023-07-30T09:05:36.000Z","lastUpdated":"7/30/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-8/chapter_8/","title":"第八章：設計短網址生成器","lastUpdatedAt":"2023-07-28T02:25:02.000Z","lastUpdated":"7/28/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-7/chapter_7/","title":"第七章：設計可用於分散式系統的唯一 ID 生成器","lastUpdatedAt":"2023-07-07T03:07:23.000Z","lastUpdated":"7/7/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/","title":"software-engineering-book-club","lastUpdatedAt":"2023-07-06T14:43:04.000Z","lastUpdated":"7/6/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/domain-driven-design/domain-modeling-made-functional/","title":"Domain-Modeling-Made-Functional","lastUpdatedAt":"2023-07-06T07:45:19.000Z","lastUpdated":"7/6/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/front-end/micro-frontend/","title":"微前端","lastUpdatedAt":"2023-07-05T02:50:46.000Z","lastUpdated":"7/5/2023"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/content/system-design/system-design-interview-alex-xu-volume1/chapter-1/chapter_1/","title":"第一章：使用者人數 -- 從零到百萬規模","lastUpdatedAt":"2023-06-22T13:53:44.000Z","lastUpdated":"6/22/2023"},"frontmatter":{"draft":false,"tags":[]}}]}},
    "staticQueryHashes": ["2230547434","2320115945","3495835395","451533639"]}